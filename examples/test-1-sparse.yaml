---
# define intervals and escalations
# in your Check resource
apiVersion: "crd.k8s.afrank.local/v1"
kind: Check
metadata:
  name: check-test-1
  namespace: default
spec:
  check_interval: 1m
  retry_interval: 3m
  notification_interval: 5m
  max_attempts: 3
  escalation: afrank@mozilla.com
  image: afrank/mozlenium
  secretRef: check-test-1-mozlenium-secrets
  check_cm: check-test-1-cm

---
# here is where you put any secrets you want your
# check to have. The secret value is base64-encoded
# For example: echo -n thisisnotsecret | base64 -w0
kind: Secret
type: Opaque
apiVersion: v1
metadata:
  name: check-test-1-mozlenium-secrets
  namespace: default
data:
  SECRETSTUFF: dGhpc2lzbm90c2VjcmV0

---
# here is the check itself, stored in a configmap
# this block was generated with 
# k create configmap check-test-1-cm --from-file=./demo-check.js
kind: ConfigMap
apiVersion: v1
metadata:
  name: check-test-1-cm
  namespace: default
data:
  demo-check.js: |+
    //demo check

    require('mozlenium')();

    var assert = require('assert');
    var url = 'https://www.google.com'

    console.log("starting check");

    $browser.get(url);

    console.log($secure.SECRETSTUFF);

    console.log("well that went great");
  escalation_template.html: |+
    <p>
      <b>Name:</b> {{ namespace }}/{{ name }}<br>
      <b>Status:</b> {{ status }}<br>
      <b>Attempt:</b> {{ attempt }}/{{ max_attempts }}<br>
      <b>Last Check:</b> {{ last_check }}<br>
      <b>More Details:</b><br> {{ logs }}<br>
    </p>
